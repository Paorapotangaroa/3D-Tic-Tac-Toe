import { useMemo } from "react";

// Same 49 winning lines from before
const winningLines = [
  // Rows
  [[0,0,0],[0,0,1],[0,0,2]],
  [[0,1,0],[0,1,1],[0,1,2]],
  [[0,2,0],[0,2,1],[0,2,2]],
  [[1,0,0],[1,0,1],[1,0,2]],
  [[1,1,0],[1,1,1],[1,1,2]],
  [[1,2,0],[1,2,1],[1,2,2]],
  [[2,0,0],[2,0,1],[2,0,2]],
  [[2,1,0],[2,1,1],[2,1,2]],
  [[2,2,0],[2,2,1],[2,2,2]],

  // Columns
  [[0,0,0],[0,1,0],[0,2,0]],
  [[0,0,1],[0,1,1],[0,2,1]],
  [[0,0,2],[0,1,2],[0,2,2]],
  [[1,0,0],[1,1,0],[1,2,0]],
  [[1,0,1],[1,1,1],[1,2,1]],
  [[1,0,2],[1,1,2],[1,2,2]],
  [[2,0,0],[2,1,0],[2,2,0]],
  [[2,0,1],[2,1,1],[2,2,1]],
  [[2,0,2],[2,1,2],[2,2,2]],

  // Pillars
  [[0,0,0],[1,0,0],[2,0,0]],
  [[0,0,1],[1,0,1],[2,0,1]],
  [[0,0,2],[1,0,2],[2,0,2]],
  [[0,1,0],[1,1,0],[2,1,0]],
  [[0,1,1],[1,1,1],[2,1,1]],
  [[0,1,2],[1,1,2],[2,1,2]],
  [[0,2,0],[1,2,0],[2,2,0]],
  [[0,2,1],[1,2,1],[2,2,1]],
  [[0,2,2],[1,2,2],[2,2,2]],

  // Diagonals (per layer)
  [[0,0,0],[0,1,1],[0,2,2]],
  [[0,0,2],[0,1,1],[0,2,0]],
  [[1,0,0],[1,1,1],[1,2,2]],
  [[1,0,2],[1,1,1],[1,2,0]],
  [[2,0,0],[2,1,1],[2,2,2]],
  [[2,0,2],[2,1,1],[2,2,0]],

  // Vertical diagonals
  [[0,0,0],[1,0,1],[2,0,2]],
  [[0,0,2],[1,0,1],[2,0,0]],
  [[0,1,0],[1,1,1],[2,1,2]],
  [[0,1,2],[1,1,1],[2,1,0]],
  [[0,2,0],[1,2,1],[2,2,2]],
  [[0,2,2],[1,2,1],[2,2,0]],

  [[0,0,0],[1,1,0],[2,2,0]],
  [[0,2,0],[1,1,0],[2,0,0]],
  [[0,0,1],[1,1,1],[2,2,1]],
  [[0,2,1],[1,1,1],[2,0,1]],
  [[0,0,2],[1,1,2],[2,2,2]],
  [[0,2,2],[1,1,2],[2,0,2]],

  // Space diagonals
  [[0,0,0],[1,1,1],[2,2,2]],
  [[0,0,2],[1,1,1],[2,2,0]],
  [[0,2,0],[1,1,1],[2,0,2]],
  [[0,2,2],[1,1,1],[2,0,0]],
];

// Hook that returns "X", "O", "Draw", or null
export function useWinner(board) {
  return useMemo(() => {
    // Check winning lines
    for (const line of winningLines) {
      const [a, b, c] = line;
      const v1 = board[a[0]][a[1]][a[2]];
      const v2 = board[b[0]][b[1]][b[2]];
      const v3 = board[c[0]][c[1]][c[2]];
      if (v1 && v1 === v2 && v1 === v3) {
        return v1; // "X" or "O"
      }
    }

    // Check draw
    const isDraw = board.every(layer =>
      layer.every(row =>
        row.every(cell => cell !== "")
      )
    );
    if (isDraw) return "Draw";

    return null; // game ongoing
  }, [board]);
}
